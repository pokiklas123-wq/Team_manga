<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± - Stream Ø¹Ù„Ù‰ Render</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #fff; min-height: 100vh; padding: 20px; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; }
        header { text-align: center; padding: 30px 0; border-bottom: 2px solid #00adb5; margin-bottom: 30px; }
        h1 { font-size: 2.5rem; color: #00adb5; margin-bottom: 10px; }
        .subtitle { color: #a3a3c2; font-size: 1.1rem; }
        .main-content { display: flex; flex-wrap: wrap; gap: 30px; margin-bottom: 30px; }
        .video-section { flex: 1; min-width: 300px; background: rgba(30, 30, 46, 0.8); border-radius: 15px; padding: 25px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); }
        .video-section h2 { color: #00d4aa; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #00d4aa; }
        video { width: 100%; background: #000; border-radius: 10px; margin-bottom: 15px; border: 3px solid #393e46; }
        .controls { text-align: center; margin-top: 20px; }
        button { background: linear-gradient(90deg, #00adb5 0%, #0097a7 100%); color: white; border: none; padding: 15px 35px; font-size: 1.1rem; border-radius: 50px; cursor: pointer; margin: 0 10px; transition: all 0.3s; font-weight: bold; box-shadow: 0 5px 15px rgba(0, 173, 181, 0.4); }
        button:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0, 173, 181, 0.6); background: linear-gradient(90deg, #0097a7 0%, #00838f 100%); }
        button:disabled { background: #555; cursor: not-allowed; transform: none; box-shadow: none; }
        #stopBtn { background: linear-gradient(90deg, #ff416c 0%, #ff4b2b 100%); }
        #stopBtn:hover { background: linear-gradient(90deg, #ff4b2b 0%, #ff416c 100%); }
        .log-section { background: rgba(30, 30, 46, 0.8); border-radius: 15px; padding: 25px; margin-top: 20px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); }
        .log-section h2 { color: #ffd700; margin-bottom: 15px; }
        #log { background: #0f0f1a; border-radius: 10px; padding: 20px; height: 300px; overflow-y: auto; font-family: monospace; font-size: 0.95rem; border: 1px solid #393e46; }
        .log-entry { margin-bottom: 10px; padding: 8px 12px; border-radius: 6px; }
        .log-info { background: rgba(0, 173, 181, 0.1); border-right: 4px solid #00adb5; }
        .log-success { background: rgba(0, 200, 83, 0.1); border-right: 4px solid #00c853; }
        .log-error { background: rgba(255, 65, 108, 0.1); border-right: 4px solid #ff416c; }
        .status { padding: 15px; border-radius: 10px; margin: 15px 0; text-align: center; font-weight: bold; }
        .status-online { background: rgba(0, 200, 83, 0.2); color: #00c853; border: 1px solid #00c853; }
        .status-offline { background: rgba(255, 65, 108, 0.2); color: #ff416c; border: 1px solid #ff416c; }
        footer { text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #393e46; color: #a3a3c2; font-size: 0.9rem; }
        @media (max-width: 768px) { h1 { font-size: 2rem; } .main-content { flex-direction: column; } button { padding: 12px 25px; margin: 5px; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¥ ØºØ±ÙØ© Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</h1>
            <p class="subtitle">Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Stream.io ÙˆÙ†Ø´Ø± Ø¹Ù„Ù‰ Render</p>
        </header>

        <div class="status" id="statusIndicator">ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø®Ø§Ø¯Ù…...</div>

        <div class="main-content">
            <section class="video-section">
                <h2>ğŸ“¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ (Ø§Ù„Ù…Ø°ÙŠØ¹)</h2>
                <video id="localVideo" autoplay muted playsinline></video>
                <div class="controls">
                    <button id="startBtn" onclick="startBroadcast()">â–¶ Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</button>
                    <button id="stopBtn" onclick="stopBroadcast()" disabled>â¹ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø«</button>
                </div>
            </section>

            <section class="video-section">
                <h2>ğŸ‘¥ ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ†</h2>
                <div id="remoteVideos"></div>
                <p style="text-align: center; color: #a3a3c2; margin-top: 15px;" id="participantsCount">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ† Ø¨Ø¹Ø¯</p>
            </section>
        </div>

        <section class="log-section">
            <h2>ğŸ“ Ø³Ø¬Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„</h2>
            <div id="log"></div>
        </section>

        <footer>
            <p>ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Stream Video SDK | Ù…Ø³ØªØ¶Ø§Ù Ø¹Ù„Ù‰ Render</p>
            <p id="serverUrl"></p>
        </footer>
    </div>

    <!-- Ù…ÙƒØªØ¨Ø© Stream SDK -->
    <script src="https://unpkg.com/@stream-io/video-styling/dist/css/styles.css"></script>
    <script src="https://cdn.jsdelivr.net/npm/@stream-io/video-sdk"></script>

    <script>
        // ==================== ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© ====================
        const API_KEY = 'r9vxmmx42jmz';  // Ù…ÙØªØ§Ø­ API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
        let streamClient = null;
        let activeCall = null;
        let participantsCount = 0;

        // ==================== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ====================
        function updateStatus(message, isOnline = true) {
            const statusEl = document.getElementById('statusIndicator');
            statusEl.textContent = message;
            statusEl.className = `status ${isOnline ? 'status-online' : 'status-offline'}`;
        }

        function logToConsole(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const messageEl = document.createElement('div');
            
            messageEl.className = `log-entry log-${type}`;
            messageEl.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            
            logDiv.appendChild(messageEl);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[Stream] ${message}`);
        }

        function updateParticipantsUI() {
            const countEl = document.getElementById('participantsCount');
            if (participantsCount === 0) {
                countEl.textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ† Ø¨Ø¹Ø¯';
            } else {
                countEl.textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ†: ${participantsCount}`;
            }
        }

        // ==================== Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… ====================
        async function checkServerHealth() {
            try {
                const baseUrl = window.location.origin;
                const response = await fetch(`${baseUrl}/health`);
                if (response.ok) {
                    updateStatus('âœ… Ø§Ù„Ø®Ø§Ø¯Ù… Ù…ØªØµÙ„ ÙˆÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ', true);
                    logToConsole('Ø§ØªØµØ§Ù„ Ø§Ù„Ø®Ø§Ø¯Ù… Ù†Ø§Ø¬Ø­', 'success');
                    document.getElementById('serverUrl').textContent = `Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Ø¯Ù…: ${baseUrl}`;
                    return true;
                }
            } catch (error) {
                updateStatus('âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', false);
                logToConsole(`ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…: ${error.message}`, 'error');
            }
            return false;
        }

        // ==================== Ø¯Ø§Ù„Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø« ====================
        async function startBroadcast() {
            try {
                const startBtn = document.getElementById('startBtn');
                const stopBtn = document.getElementById('stopBtn');
                
                startBtn.disabled = true;
                startBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯...';
                logToConsole('--- Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ---', 'info');

                // 1. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù Ù…Ø³ØªØ®Ø¯Ù… ÙØ±ÙŠØ¯
                const userId = `broadcaster_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                logToConsole(`ğŸ†” Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø°ÙŠØ¹: ${userId}`, 'info');

                // 2. Ø¬Ù„Ø¨ Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
                logToConsole('ğŸ” Ø¬Ø§Ø±ÙŠ Ø·Ù„Ø¨ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„...', 'info');
                const baseUrl = window.location.origin;
                const tokenResponse = await fetch(`${baseUrl}/api/token?user_id=${encodeURIComponent(userId)}`);
                
                if (!tokenResponse.ok) {
                    const errorData = await tokenResponse.json().catch(() => ({}));
                    throw new Error(errorData.error || `ÙØ´Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªÙˆÙƒÙ† (${tokenResponse.status})`);
                }
                
                const { token, api_key } = await tokenResponse.json();
                logToConsole('âœ… ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');

                // 3. ØªÙ‡ÙŠØ¦Ø© Ø¹Ù…ÙŠÙ„ Stream
                logToConsole('âš™ï¸ Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø¹Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ...', 'info');
                streamClient = new stream.VideoClient(api_key || API_KEY, { 
                    token, 
                    user: { 
                        id: userId,
                        name: 'Ù…Ø°ÙŠØ¹ Ø§Ù„Ø¨Ø«',
                        image: `https://ui-avatars.com/api/?name=Broadcaster&background=00adb5&color=fff`
                    }
                });

                // 4. Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                logToConsole('ğŸ”— Ø¬Ø§Ø±ÙŠ ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…...', 'info');
                await streamClient.connectUser({ id: userId }, token);
                logToConsole('âœ… ØªÙ… ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');

                // 5. Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ ØºØ±ÙØ© Ø§Ù„Ø¨Ø«
                logToConsole('ğŸšª Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ ØºØ±ÙØ© Ø§Ù„Ø¨Ø«...', 'info');
                const callId = `live-room-${Date.now()}`;
                activeCall = streamClient.call('livestream', callId);
                
                await activeCall.join({ 
                    create: true,
                    data: {
                        custom: {
                            title: 'Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± Ø­ÙŠ',
                            description: 'Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ Stream Ø¹Ù„Ù‰ Render',
                            host: userId
                        }
                    }
                });
                
                logToConsole(`âœ… Ø§Ù†Ø¶Ù…Ù…Øª Ø¥Ù„Ù‰ Ø§Ù„ØºØ±ÙØ©: ${callId}`, 'success');

                // 6. ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†
                logToConsole('ğŸ“¹ Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...', 'info');
                await activeCall.camera.enable();
                
                logToConsole('ğŸ¤ Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†...', 'info');
                await activeCall.microphone.enable();
                
                logToConsole('âœ… ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ø¨Ù†Ø¬Ø§Ø­', 'success');

                // 7. Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø­Ù„ÙŠ
                const localVideo = document.getElementById('localVideo');
                await activeCall.camera.setVideoElement(localVideo);
                
                logToConsole('ğŸ¬ Ø¬Ø§Ø±ÙŠ Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø­Ù„ÙŠ...', 'info');

                // 8. ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ­ÙƒÙ…
                startBtn.textContent = 'ğŸ”´ ØªØ¨Ø« Ø§Ù„Ø¢Ù†';
                stopBtn.disabled = false;
                
                updateStatus('ğŸ”´ Ø£Ù†Øª ØªØ¨Ø« Ù…Ø¨Ø§Ø´Ø±Ø© Ø§Ù„Ø¢Ù†', true);
                logToConsole('ğŸ‰ Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');

                // 9. Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ†
                setupParticipantListeners();

                // 10. Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† Ù„ØªØµØ¹ÙŠØ¯ Ø§Ù„Ø¬ÙˆØ¯Ø© (Ø¥Ø°Ø§ Ù„Ø²Ù…)
                setTimeout(() => {
                    if (activeCall) {
                        activeCall.camera.setTargetResolution({ width: 1280, height: 720 });
                        logToConsole('ğŸ”„ ØªÙ… Ø·Ù„Ø¨ Ø¯Ù‚Ø© ÙÙŠØ¯ÙŠÙˆ Ø£Ø¹Ù„Ù‰ (720p)', 'info');
                    }
                }, 2000);

            } catch (error) {
                logToConsole(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø«: ${error.message}`, 'error');
                updateStatus(`ÙØ´Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø«: ${error.message}`, false);
                
                const startBtn = document.getElementById('startBtn');
                startBtn.disabled = false;
                startBtn.textContent = 'â–¶ Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±';
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ´Ù„
                if (streamClient) {
                    try { await streamClient.disconnectUser(); } catch {}
                    streamClient = null;
                }
                activeCall = null;
            }
        }

        // ==================== Ø¯Ø§Ù„Ø© Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ† ====================
        function setupParticipantListeners() {
            if (!activeCall) return;
            
            // Ø¹Ù†Ø¯ Ø§Ù†Ø¶Ù…Ø§Ù… Ù…Ø´Ø§Ù‡Ø¯ Ø¬Ø¯ÙŠØ¯
            activeCall.on('participantJoined', async (participant) => {
                participantsCount++;
                updateParticipantsUI();
                
                logToConsole(`ğŸ‘¤ ${participant.user.name || participant.user.id} Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø«`, 'info');
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± ÙÙŠØ¯ÙŠÙˆ Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯
                const remoteVideosDiv = document.getElementById('remoteVideos');
                const videoContainer = document.createElement('div');
                videoContainer.className = 'participant-video';
                videoContainer.id = `participant-${participant.sessionId}`;
                videoContainer.style.cssText = `
                    position: relative;
                    display: inline-block;
                    margin: 10px;
                    width: 200px;
                    background: #1e1e2e;
                    border-radius: 10px;
                    overflow: hidden;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                `;
                
                const videoElement = document.createElement('video');
                videoElement.id = `video-${participant.sessionId}`;
                videoElement.autoplay = true;
                videoElement.playsInline = true;
                videoElement.style.cssText = 'width: 100%; border-radius: 10px;';
                
                const nameOverlay = document.createElement('div');
                nameOverlay.style.cssText = `
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    right: 0;
                    background: rgba(0,0,0,0.7);
                    color: white;
                    padding: 5px 10px;
                    font-size: 0.8rem;
                    border-bottom-left-radius: 10px;
                    border-bottom-right-radius: 10px;
                `;
                nameOverlay.textContent = participant.user.name || participant.user.id;
                
                videoContainer.appendChild(videoElement);
                videoContainer.appendChild(nameOverlay);
                remoteVideosDiv.appendChild(videoContainer);
                
                // ØªÙˆØµÙŠÙ„ ØªØ¯ÙÙ‚ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ø§Ù„Ø¹Ù†ØµØ±
                try {
                    await participant.setVideoElement(videoElement);
                    logToConsole(`âœ… ØªÙ… ØªÙˆØµÙŠÙ„ ÙÙŠØ¯ÙŠÙˆ ${participant.user.id}`, 'success');
                } catch (videoError) {
                    logToConsole(`âš ï¸ Ù„Ù… ÙŠØªÙ…ÙƒÙ† ${participant.user.id} Ù…Ù† Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ`, 'info');
                }
            });
            
            // Ø¹Ù†Ø¯ Ù…ØºØ§Ø¯Ø±Ø© Ù…Ø´Ø§Ù‡Ø¯
            activeCall.on('participantLeft', (participant) => {
                participantsCount = Math.max(0, participantsCount - 1);
                updateParticipantsUI();
                
                logToConsole(`ğŸ‘¤ ${participant.user.name || participant.user.id} ØºØ§Ø¯Ø± Ø§Ù„Ø¨Ø«`, 'info');
                
                // Ø¥Ø²Ø§Ù„Ø© Ø¹Ù†ØµØ± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                const videoContainer = document.getElementById(`participant-${participant.sessionId}`);
                if (videoContainer) {
                    videoContainer.remove();
                }
            });
            
            // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ
            activeCall.on('participantUpdated', (participant) => {
                logToConsole(`ğŸ”„ ${participant.user.id} Ù‚Ø§Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„ØªÙ‡`, 'info');
            });
        }

        // ==================== Ø¯Ø§Ù„Ø© Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø« ====================
        async function stopBroadcast() {
            try {
                logToConsole('â¹ Ø¬Ø§Ø±ÙŠ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø«...', 'info');
                
                const startBtn = document.getElementById('startBtn');
                const stopBtn = document.getElementById('stopBtn');
                
                stopBtn.disabled = true;
                stopBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù...';
                
                // 1. Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØºØ±ÙØ©
                if (activeCall) {
                    await activeCall.leave();
                    activeCall = null;
                    logToConsole('âœ… ØºØ§Ø¯Ø±Øª ØºØ±ÙØ© Ø§Ù„Ø¨Ø«', 'success');
                }
                
                // 2. Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                if (streamClient) {
                    await streamClient.disconnectUser();
                    streamClient = null;
                    logToConsole('âœ… ØªÙ… Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'success');
                }
                
                // 3. Ø¥ÙŠÙ‚Ø§Ù ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                const localVideo = document.getElementById('localVideo');
                if (localVideo.srcObject) {
                    localVideo.srcObject.getTracks().forEach(track => track.stop());
                    localVideo.srcObject = null;
                }
                
                // 4. ØªÙ†Ø¸ÙŠÙ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ†
                document.getElementById('remoteVideos').innerHTML = '';
                participantsCount = 0;
                updateParticipantsUI();
                
                // 5. ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ­ÙƒÙ…
                startBtn.disabled = false;
                startBtn.textContent = 'â–¶ Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±';
                stopBtn.textContent = 'â¹ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø«';
                
                updateStatus('âœ… ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø« Ø¨Ù†Ø¬Ø§Ø­', true);
                logToConsole('ğŸ¬ Ø§Ù„Ø¨Ø« Ù…ØªÙˆÙ‚ÙØŒ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯', 'success');
                
            } catch (error) {
                logToConsole(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø«: ${error.message}`, 'error');
                updateStatus(`ÙØ´Ù„ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø«: ${error.message}`, false);
            }
        }

        // ==================== Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ====================
        document.addEventListener('DOMContentLoaded', async () => {
            logToConsole('ğŸ“„ ØµÙØ­Ø© Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø¬Ø§Ù‡Ø²Ø©', 'success');
            logToConsole('â„¹ï¸ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±" Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø«', 'info');
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø®Ø§Ø¯Ù…
            await checkServerHealth();
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
            window.addEventListener('error', (event) => {
                logToConsole(`âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙØ­Ø©: ${event.message}`, 'error');
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„
            window.addEventListener('offline', () => {
                updateStatus('ğŸŒ ØªÙ… ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', false);
                logToConsole('Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'error');
            });
            
            window.addEventListener('online', async () => {
                updateStatus('ğŸ”ƒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„...', false);
                logToConsole('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'info');
                await checkServerHealth();
            });
        });
    </script>
</body>
</html>
